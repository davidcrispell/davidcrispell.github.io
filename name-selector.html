<!DOCTYPE html>
<html lang="en">
<!-- Head and previous styles remain the same until the animated-letter classes -->
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Random Name Selector</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link
    rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap"
  />
  <style>
    /* Previous styles remain identical until .animated-letter */
    body {
      font-family: 'Press Start 2P', monospace;
      margin: 0;
      padding: 0;
      text-align: center;
      color: #fff;
      background: radial-gradient(circle at center, #000 10%, #111 60%, #000 100%);
      background-repeat: no-repeat;
      background-attachment: fixed;
      min-height: 100vh;
    }

    nav {
      margin-bottom: 20px;
      background: linear-gradient(90deg, #FFD700, #FF0000);
      padding: 10px;
      border-bottom: 3px solid #660000;
      box-shadow: 0 4px 8px rgba(255, 0, 0, 0.7);
    }

    nav ul {
      list-style-type: none;
      padding: 0;
      margin: 0;
      display: flex;
      justify-content: center;
      gap: 30px;
    }

    nav ul li a {
      text-decoration: none;
      color: #222;
      font-weight: bold;
      font-size: 14px;
    }

    nav ul li a:hover {
      color: #fff;
      text-shadow: 1px 1px 2px #000;
    }

    h1 {
      margin-top: 40px;
      margin-bottom: 24px;
      font-size: 30px;
      color: #FFD700;
      text-shadow: 
          0 0 10px #FFD700,
          0 0 20px #FFD700,
          0 0 30px #FFD700,
          0 0 40px #FF4500,
          0 0 70px #FF4500,
          0 0 80px #FF4500,
          0 0 100px #FF4500;
    }

    p {
      margin: 16px auto;
      max-width: 750px;
      line-height: 1.4;
      color: #ccc;
      font-size: 14px;
    }

    .form-group {
      margin: 20px auto;
      max-width: 750px;
      text-align: left;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }

    label {
      color: #FFD700;
      font-size: 14px;
      text-transform: uppercase;
    }

    .btn {
      padding: 10px 20px;
      margin: 10px 5px;
      background: linear-gradient(90deg, #FFD700, #FF0000);
      color: #222;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
      font-size: 12px;
      box-shadow: 0 4px 8px rgba(255, 0, 0, 0.7);
      transition: transform 0.2s ease;
    }

    .btn:hover {
      transform: scale(1.05);
      background: linear-gradient(90deg, #FF0000, #FFD700);
      color: #fff;
    }

    input[type="file"],
    input[type="number"] {
      padding: 10px;
      border-radius: 5px;
      border: 2px solid #FFD700;
      background: #222;
      color: #fff;
      font-family: 'Press Start 2P', monospace;
      font-size: 12px;
      width: 250px;
      text-align: center;
    }

    input[type="number"] {
      width: 100px;
    }

    .results {
      margin: 20px auto;
      max-width: 750px;
      background: rgba(0, 0, 0, 0.7);
      border: 3px solid #FF0000;
      border-radius: 10px;
      padding: 20px;
      color: #fff;
      box-shadow: 0 0 10px rgba(255, 0, 0, 0.7);
      text-align: left;
    }

    .results h2 {
      margin-top: 0;
      text-align: center;
      font-size: 24px;
    }

    .animated-title {
      display: inline-block;
    }

    .animated-letter {
      display: inline-block;
      color: #FFD700;
      opacity: 1;
      transition: all 0.3s ease;
    }

    /* Updated: Start with no animation */
    .animated-letter.odd, .animated-letter.even {
      animation: none;
    }

    /* Updated: Brighter colors and adjusted fade color */
    @keyframes glowOdd {
      from {
        color: #FFFFFF;
        text-shadow: 0 0 5px #FFFFFF,
                     0 0 10px #FFD700,
                     0 0 15px #FF4500;
      }
      to {
        color: #FFD700;
        text-shadow: 0 0 2px #FFD700;
      }
    }

    @keyframes glowEven {
      from {
        color: #FFD700;
        text-shadow: 0 0 2px #FFD700;
      }
      to {
        color: #FFFFFF;
        text-shadow: 0 0 5px #FFFFFF,
                     0 0 10px #FFD700,
                     0 0 15px #FF4500;
      }
    }

    .results p {
      margin: 8px 0;
      font-size: 14px;
      color: #fff;
    }

    .signature {
      margin-top: 60px;
      font-size: 14px;
      color: #FFD700;
      text-shadow: 0 0 8px #FF4500;
    }
    
    .obfuscated {
      font-family: monospace;
      color: #FF00FF;
      text-shadow: 0 0 5px #FF00FF;
    }


    .date {
      margin: 24px 0;
      font-size: 12px;
      color: #999;
    }

    #fileInput {
      display: none;
    }

    .flash {
      animation: plinkoFlash 0.55s alternate;
      animation-iteration-count: 30;
    }

    @keyframes plinkoFlash {
      0% {
        border-color: #FF0000;
        box-shadow: 0 0 10px #FF0000;
      }
      100% {
        border-color: #FFD700;
        box-shadow: 0 0 20px #FFD700;
      }
    }

    .flash-faster {
      animation: fasterFlash 0.25s alternate infinite;
    }

    @keyframes fasterFlash {
      0% {
        color: #FF00FF;
        text-shadow: 0 0 5px #FF00FF;
      }
      100% {
        color: #00FFFF;
        text-shadow: 0 0 10px #00FFFF;
      }
    }
  </style>

  <script>
    let currentNames = [];
    const audioSource = 'https://davidcrispell.github.io/GAMBLING.mp3';
    let alternatingInterval = null;
    let titleInterval = null;

    function createAnimatedTitle() {
      const title = "WINNERS!";
      let html = '<div class="animated-title">';
      
      for (let i = 0; i < title.length; i++) {
        html += `<span class="animated-letter ${i % 2 === 0 ? 'even' : 'odd'}">${title[i]}</span>`;
      }
      
      html += '</div>';
      return html;
    }

    function startTitleAnimation() {
      const letters = document.querySelectorAll('.animated-letter');
      letters.forEach((letter, index) => {
        if (index % 2 === 0) {
          letter.style.animation = 'glowEven 0.5s ease-in-out infinite alternate';
        } else {
          letter.style.animation = 'glowOdd 0.5s ease-in-out infinite alternate';
        }
      });
    }

    function playChaoticSound() {
      const newAudio = new Audio(audioSource);
      newAudio.play().catch(err => {
        console.warn('Autoplay may be blocked.', err);
      });
    }

    function handleFileSelection(event) {
      const file = event.target.files[0];
      const numSelections = parseInt(
        document.getElementById('numSelections').value
      ) || 10;

      if (!file) {
        alert('Please select a file.');
        return;
      }

      const fileExt = file.name.split('.').pop().toLowerCase();
      const delimiter =
        fileExt === 'tsv' ? '\t' : fileExt === 'csv' ? ',' : null;

      if (!delimiter) {
        alert('File must be either .csv or .tsv');
        return;
      }

      const reader = new FileReader();
      reader.onload = () => {
        const text = reader.result;
        const lines = text
          .split('\n')
          .map((line) => line.trim())
          .filter((line) => line !== '');

        if (lines.length <= 1) {
          alert('Not enough data in the file.');
          return;
        }

        const rows = lines.map((line) => line.split(delimiter));
        rows.shift();

        currentNames = rows
          .filter((row) => row.length >= 2)
          .map((row) => [row[0].trim(), row[1].trim()]);

        if (currentNames.length < numSelections) {
          alert(
            `File contains only ${currentNames.length} names, but ${numSelections} were requested.`
          );
          return;
        }

        displayRandomNames(numSelections);
        playChaoticSound();
        flashLights();
      };

      reader.readAsText(file);
    }

    // Helper function to generate random characters
function generateRandomChars(length) {
  const chars = '!@#$%^&*()_+-=[]{}|;:,.<>?ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
  return Array.from({ length }, () => chars[Math.floor(Math.random() * chars.length)]).join('');
}

// Modified displayRandomNames function with scrambling
function displayRandomNames(numSelections) {
  if (currentNames.length < numSelections) {
    alert('Not enough names available. Please upload a larger file.');
    return;
  }

  const selected = [];
  const namesCopy = [...currentNames];

  while (selected.length < numSelections) {
    const randomIndex = Math.floor(Math.random() * namesCopy.length);
    selected.push(namesCopy.splice(randomIndex, 1)[0]);
  }

  const resultsDiv = document.getElementById('results');
  resultsDiv.innerHTML = `<h2>${createAnimatedTitle()}</h2>`;

  // Create elements with obfuscated text first
  selected.forEach(([first, last], index) => {
    const nameElement = document.createElement('p');
    const fullNameLength = first.length + last.length + 1; // +1 for space
    nameElement.innerHTML = `${index + 1}. <span class="obfuscated">${generateRandomChars(fullNameLength)}</span>`;
    nameElement.dataset.finalText = `${index + 1}. ${first} ${last}`;
    resultsDiv.appendChild(nameElement);
  });

  // Start the scrambling process
  let obfuscationInterval = setInterval(() => {
    const elements = document.querySelectorAll('#results p');
    elements.forEach(element => {
      const finalText = element.dataset.finalText.split('. ')[1];
      element.innerHTML = `${element.dataset.finalText.split('.')[0]}. <span class="obfuscated">${generateRandomChars(finalText.length)}</span>`;
    });
  }, 100);

  // After 5 seconds, reveal the real names
  setTimeout(() => {
    clearInterval(obfuscationInterval);
    const elements = document.querySelectorAll('#results p');
    elements.forEach(element => {
      element.textContent = element.dataset.finalText;
    });

    // Start title animation
    if (titleInterval) {
      clearTimeout(titleInterval);
    }
    titleInterval = setTimeout(startTitleAnimation, 1000);
  }, 7000);
}

    function flashLights() {
      const resultsDiv = document.getElementById('results');
      resultsDiv.classList.remove('flash');
      void resultsDiv.offsetWidth;
      resultsDiv.classList.add('flash');

      if (alternatingInterval) {
        clearInterval(alternatingInterval);
      }

      setTimeout(() => {
        let toggle = false;
        alternatingInterval = setInterval(() => {
          toggle = !toggle;
          const allNames = document.querySelectorAll('#results p');

          allNames.forEach((p) => p.classList.remove('flash-faster'));

          if (toggle) {
            for (let i = 0; i < allNames.length; i += 2) {
              allNames[i].classList.add('flash-faster');
            }
          } else {
            for (let i = 1; i < allNames.length; i += 2) {
              allNames[i].classList.add('flash-faster');
            }
          }
        }, 250);
      }, 6000);
    }

    function regenerateNames() {
      const numSelections = parseInt(
        document.getElementById('numSelections').value
      ) || 10;
      if (currentNames.length === 0) {
        alert('Please upload a file first.');
        return;
      }

      playChaoticSound();
      displayRandomNames(numSelections);
      flashLights();
    }
  </script>
</head>
<body>
  <nav>
    <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="about.html">About</a></li>
            <li><a href="writing.html">Writing</a></li>
            <li><a href="projects.html">Projects</a></li>
            <li><a href="contact.html">Contact</a></li>
    </ul>
  </nav>

  <h1>Lottery Machine</h1>

  <p>
    Select a CSV or TSV file and specify the number of names to randomly select.
    You can regenerate selections without re-uploading the file.
  </p>

  <input
    type="file"
    id="fileInput"
    accept=".csv,.tsv"
    onchange="handleFileSelection(event)"
  />

  <div class="form-group">
    <label for="numSelections">How many winners?</label>
    <input type="number" id="numSelections" value="10" min="1" />
  </div>

  <button class="btn" onclick="document.getElementById('fileInput').click()">
    Select File
  </button>
  <button class="btn" onclick="regenerateNames()">
    Regenerate
  </button>

  <div id="results" class="results"></div>

  <div class="signature">
    join AISI (artificial intelligence student initiative) on buffconnect!
  </div>

  <div class="date">
    last updated (reeeaaallly bad gambling styling) January 16, 2025
  </div>
</body>
</html>
